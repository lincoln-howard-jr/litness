(this.webpackJsonplitness=this.webpackJsonplitness||[]).push([[0],{117:function(e,t,n){},122:function(e,t){},126:function(e,t,n){"use strict";n.r(t);var r=n(14),c=n.n(r),a=n(94),s=n.n(a),o=(n(117),n(19)),i=n(18),u=n.n(i),l=n(36),j=window.arcgisRest,p=new j.ApiKey({key:"AAPK827c8d799c9f479bb6527fdfe01819026nJ4HXONEvXwkFIsjOMskDVGFYKeCgUGlZi9lgE2xnlQ7ROGR9D3ypGuaHv4XcNb"}),b={locationAvailable:!1,places:null,coords:{lat:null,lng:null},getPlaces:function(){return new Promise((function(e){}))}};var d=n(89),f=n(4),h={iter:0,pins:[],featureSet:{type:"FeatureCollection",features:[]},pinErr:null,getPins:function(){},createPin:function(){return new Promise((function(e){return e}))}};var O=n(66),x=function(e){return new Promise(function(){var t=Object(l.a)(u.a.mark((function t(n,r){var c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/usernames/".concat(e));case 3:return c=t.sent,t.t0=n,t.next=7,c.json();case 7:t.t1=t.sent,(0,t.t0)(t.t1),t.next=14;break;case 11:t.prev=11,t.t2=t.catch(0),r(t.t2);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e,n){return t.apply(this,arguments)}}())},v={ClientId:"2nl7v5gphbluvp0lhu8aooqhe3",UserPoolId:"us-east-1_Xsf7vUqcY"},m={isAuthenticated:!1,promptForCode:!1,headers:{get:{},post:{"Content-Type":""}},authError:null,getCode:function(e){},answer:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){})),logout:function(){return new Promise((function(e){return e()}))}};var g=n(5),w={freeze:function(){return function(){}},user:m,pins:h,location:b},k=Object(r.createContext)(w),S=function(){return Object(r.useContext)(k)};function y(e){var t=Object(r.useState)("none"),n=Object(o.a)(t,2),c=n[0],a=n[1],s=function(){return a("frozen"),function(){a("none")}},i=function(e){var t,n=new O.e(v),c=n.getCurrentUser(),a=Object(r.useState)(""),s=Object(o.a)(a,2),i=s[0],j=s[1],p=Object(r.useState)(null),b=Object(o.a)(p,2),d=b[0],f=b[1],h={get:{"x-amz-access-token":i},post:{"Content-Type":"application/json","x-amz-access-token":i}},m=Object(r.useState)(null),g=Object(o.a)(m,2),w=g[0],k=g[1],S=Object(r.useState)(!1),y=Object(o.a)(S,2),C=y[0],P=y[1],N=Object(r.useState)(!1),E=Object(o.a)(N,2),A=E[0],F=E[1],T=Object(r.useState)((function(e){})),z=Object(o.a)(T,2),I=z[0],L=z[1],U=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=4;break}c.getSession((function(e,t){return e?Promise.reject(e):(j(t.getAccessToken().getJwtToken()),f(new O.b({RefreshToken:t.getRefreshToken().getToken()})),P(!0),Promise.resolve())})),e.next=5;break;case 4:return e.abrupt("return",Promise.reject("user dne"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c&&d&&c.refreshSession(d,(function(e){return e?Promise.reject(e):U()}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(l.a)(u.a.mark((function e(r,a){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[new O.d({Name:"phone_number",Value:t})],n.signUp(t,"Passwords are useless!",s,[],(function(e,t){return e?a(e):((null===t||void 0===t?void 0:t.user)&&(c=t.user),r())}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var r=Object(l.a)(u.a.mark((function r(a){var s,o;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=e(),o=!0,r.prev=2,r.next=5,x(a);case 5:o=r.sent,r.next=11;break;case 8:r.prev=8,r.t0=r.catch(2),k("error while checking if user exists");case 11:if(o){r.next=21;break}return r.prev=12,r.next=15,D(a);case 15:r.next=21;break;case 17:return r.prev=17,r.t1=r.catch(12),k("error while registering user"),r.abrupt("return");case 21:t=new O.a({Username:a,ClientMetadata:{phoneNumber:a}}),(c=new O.c({Username:a,Pool:n})).setAuthenticationFlowType("CUSTOM_CHALLENGE"),c.initiateAuth(t,{onSuccess:function(){U(),s()},onFailure:function(e){k(e),s()},customChallenge:function(){var t=this;L((function(){return function(n){var r;null===(r=c)||void 0===r||r.sendCustomChallengeAnswer(n,t),s=e()}})),F(!0)}});case 25:case"end":return r.stop()}}),r,null,[[2,8],[12,17]])})));return function(e){return r.apply(this,arguments)}}(),J=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return e.next=4,R();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){J()}),[]),{isAuthenticated:C,promptForCode:A,headers:h,authError:w,getCode:G,answer:I,logout:function(){return new Promise(function(){var e=Object(l.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=4;break}return e.abrupt("return",t(c.signOut()));case 4:return e.abrupt("return",n("user dne"));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}(s),b=function(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(null),s=Object(o.a)(a,2),i=s[0],b=s[1],d=Object(r.useState)(null),f=Object(o.a)(d,2),h=f[0],O=f[1],x=Object(r.useState)(null),v=Object(o.a)(x,2),m=v[0],g=v[1],w=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.geocode({params:{category:"Arts and Entertainment,Coffee Shop,Nightlife Spot,Parks and Outdoors",location:"".concat(m,",").concat(h),distance:2e3,maxLocations:6},outFields:"*",authentication:p});case 3:r=e.sent,b(r.candidates),t(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),n();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(e){O(e.coords.latitude),g(e.coords.longitude),c(!0)},S=function(){c(!1),O(null),g(null)};return Object(r.useEffect)((function(){var e=window.navigator.geolocation.watchPosition(k,S,{enableHighAccuracy:!0,timeout:1e3});return function(){window.navigator.geolocation.clearWatch(e)}}),[]),{locationAvailable:n,places:i,coords:{lat:h,lng:m},getPlaces:w}}(),m=function(e,t,n){var c=Object(r.useState)(h.iter),a=Object(o.a)(c,2),s=a[0],i=a[1],j=Object(r.useState)(h.pins),p=Object(o.a)(j,2),b=p[0],O=p[1],x=Object(r.useState)(h.featureSet),v=Object(o.a)(x,2),m=v[0],g=v[1],w=Object(r.useState)(h.pinErr),k=Object(o.a)(w,2),S=k[0],y=k[1],C=function(){var e=Object(l.a)(u.a.mark((function e(){var n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/pins?lat=".concat(t.coords.lat,"&lng=").concat(t.coords.lng,"&r=0.5"));case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,c={type:"FeatureCollection",features:r.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:Object(f.d)([e.lng,e.lat])},properties:{age:e.datetimeDropped-Date.now()/1e3,litness:e.litness}}}))},O(r),g(c),i(s+1),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),y((null===e.t0||void 0===e.t0?void 0:e.t0.toString())||"unknown server error");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t.coords.lng&&t.coords.lat&&C()}),[t.coords.lng,t.coords.lat]),{iter:s,pins:b,featureSet:m,pinErr:S,getPins:C,createPin:function(r){return new Promise(function(){var c=Object(l.a)(u.a.mark((function c(a,s){var o,i;return u.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:o=n();try{i=Object(d.a)(Object(d.a)({},t.coords),{},{litness:r}),fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/pins",{method:"post",headers:e.headers.post,body:JSON.stringify(i)})}catch(a){y((null===a||void 0===a?void 0:a.toString())||"unknown error")}finally{o()}case 2:case"end":return c.stop()}}),c)})));return function(e,t){return c.apply(this,arguments)}}())}}}(i,b,s),w={freeze:s,user:i,pins:m,location:b};return Object(g.jsxs)(k.Provider,{value:w,children:[Object(g.jsx)("div",{className:"freeze ".concat(c)}),e.children]})}function C(){var e,t=S().user,n=t.isAuthenticated,c=t.promptForCode,a=t.authError,s=t.getCode,i=t.answer,u=Object(r.useState)(""),l=Object(o.a)(u,2),j=l[0],p=l[1],b=Object(r.useRef)(null);return n?null:c?Object(g.jsxs)("div",{className:"auth-container",children:[Object(g.jsx)("header",{children:Object(g.jsx)("p",{children:"We texted you a code! Enter it here!"})}),Object(g.jsx)("input",{ref:b,autoComplete:"one-time-code",placeholder:"Secret code here"}),Object(g.jsx)("button",{onClick:function(){var e;(null===(e=b.current)||void 0===e?void 0:e.value)&&i(b.current.value)},children:"Send Code"})]}):Object(g.jsxs)("div",{className:"auth-conatiner",children:[Object(g.jsx)("header",{children:Object(g.jsx)("h1",{children:"Litness Sign In"})}),a&&Object(g.jsx)("div",{className:"error",children:a}),Object(g.jsx)("input",{type:"text",placeholder:"(012) 345-6789",autoComplete:"off",onChange:function(e){return p(e.target.value.replaceAll(/[^0-9]/g,""))},value:(e=j,e.length>10&&(e=e.substr(0,10)),0===e.length?e:e.length<4?"(".concat(e):e.length<7?"(".concat(e.substr(0,3),") ").concat(e.substr(3)):"(".concat(e.substr(0,3),") ").concat(e.substr(3,3),"-").concat(e.substr(6)))}),Object(g.jsx)("button",{onClick:function(){s(function(e){var t=e.replaceAll(/[^0-9]/g,"");if(10!==t.length)throw new Error("Phone number must be 10 digits, current length: "+t.length);return"+1"+t}(j))},children:"Sign In"})]})}var P=n.p+"static/media/pin.c45e97d1.png",N=n.p+"static/media/fire.4fa412f3.png";function E(){var e=S(),t=Object(r.useState)(!1),n=Object(o.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(!1),i=Object(o.a)(s,2),j=i[0],p=i[1],b=Object(r.useState)(0),d=Object(o.a)(b,2),f=(d[0],d[1]),h=function(t){return Object(l.a)(u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,p(!0),a(!1),f(t),n.next=6,e.location.getPlaces();case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),alert("error while getting nearby places");case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))};return e.user.isAuthenticated&&e.location.locationAvailable?e.location.places?Object(g.jsx)("div",{className:"drop-pin-backdrop",children:Object(g.jsxs)("div",{className:"drop-pin place-list",children:[Object(g.jsx)("header",{children:Object(g.jsx)("h1",{children:"Select current location:"})}),e.location.places.map((function(e){return Object(g.jsx)("div",{className:"drop-pin place",children:Object(g.jsx)("h3",{children:e.attributes.PlaceName})})}))]})}):j?Object(g.jsx)("div",{className:"drop-pin-backdrop",children:Object(g.jsxs)("div",{className:"drop-pin place-list",children:[Object(g.jsx)("div",{className:"drop-pin place placeholder",children:Object(g.jsx)("header",{children:Object(g.jsx)("h2",{})})}),Object(g.jsx)("div",{className:"drop-pin place placeholder",children:Object(g.jsx)("header",{children:Object(g.jsx)("h2",{})})}),Object(g.jsx)("div",{className:"drop-pin place placeholder",children:Object(g.jsx)("header",{children:Object(g.jsx)("h2",{})})}),Object(g.jsx)("div",{className:"drop-pin place placeholder",children:Object(g.jsx)("header",{children:Object(g.jsx)("h2",{})})}),Object(g.jsx)("div",{className:"drop-pin place placeholder",children:Object(g.jsx)("header",{children:Object(g.jsx)("h2",{})})})]})}):c?Object(g.jsx)("div",{className:"drop-pin-backdrop",children:Object(g.jsxs)("div",{className:"drop-pin-list",children:[Object(g.jsx)("button",{onClick:function(){return a(!1)},className:"fire-button cancel",children:"X"}),Object(g.jsx)("button",{onClick:h(1),className:"fire-button one",children:Object(g.jsx)("img",{src:N})}),Object(g.jsxs)("button",{onClick:h(2),className:"fire-button two",children:[Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N})]}),Object(g.jsxs)("button",{onClick:h(3),className:"fire-button three",children:[Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N})]}),Object(g.jsxs)("button",{onClick:h(4),className:"fire-button four",children:[Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N})]}),Object(g.jsxs)("button",{onClick:h(5),className:"fire-button five",children:[Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N}),Object(g.jsx)("img",{src:N})]})]})}):Object(g.jsx)("button",{onClick:function(){return a(!0)},className:"drop-pin-button",children:Object(g.jsx)("img",{src:P})}):null}var A=n(95),F=n(54),T=n(97),z=n(86),I=n(88),L=n(87),U=n(96),R=n(90),D=n(82),G=n(68),J=function(e){return new R.b({image:new G.a({radius:8,fill:new D.a({color:[255,0,0,parseInt(e.get("litness"))/25]})})})};function X(){var e=S(),t=Object(r.useRef)(null),n=Object(r.useState)(null),c=Object(o.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(15),u=Object(o.a)(i,2),l=u[0],j=(u[1],Object(r.useState)(null)),p=Object(o.a)(j,2),b=p[0],d=p[1];return Object(r.useEffect)((function(){var t={view:new F.a({zoom:l,minZoom:l,maxZoom:l}),layers:[new T.a({source:new U.a}),new z.a({source:new I.a({features:(new L.a).readFeatures(e.pins.featureSet)})})],controls:[],overlays:[]},n=new A.a(t);s(n)}),[]),Object(r.useEffect)((function(){a&&t.current&&a.setTarget(t.current)}),[e.location.locationAvailable]),Object(r.useEffect)((function(){a&&a.getView().setZoom(l)}),[l]),Object(r.useEffect)((function(){b&&a&&a.getView().setCenter(b)}),[b]),Object(r.useEffect)((function(){e.location.coords.lat&&e.location.coords.lng&&d(Object(f.d)([e.location.coords.lng,e.location.coords.lat]))}),[e.location.coords.lat,e.location.coords.lng]),Object(r.useEffect)((function(){null===a||void 0===a||a.getLayers().removeAt(1);var t={source:new I.a({features:(new L.a).readFeatures(e.pins.featureSet)}),style:J},n=new z.a(t);console.log(e.pins.featureSet,n,t),null===a||void 0===a||a.getLayers().push(n)}),[e.pins.iter]),Object(g.jsx)("div",{id:"ol-map",className:e.user.isAuthenticated?void 0:"hidden",ref:t})}var H=function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(C,{}),Object(g.jsx)(E,{}),Object(g.jsx)(X,{})]})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,127)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};s.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(y,{children:Object(g.jsx)(H,{})})}),document.getElementById("root")),M()}},[[126,1,2]]]);
//# sourceMappingURL=main.50a0363b.chunk.js.map