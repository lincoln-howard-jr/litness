(this.webpackJsonplitness=this.webpackJsonplitness||[]).push([[0],{121:function(e,t,n){},126:function(e,t){},130:function(e,t,n){"use strict";n.r(t);var r=n(14),c=n.n(r),a=n(97),s=n.n(a),o=(n(121),n(19)),i=n(17),u=n.n(i),l=n(32),j=window.arcgisRest,d=new j.ApiKey({key:"AAPK827c8d799c9f479bb6527fdfe01819026nJ4HXONEvXwkFIsjOMskDVGFYKeCgUGlZi9lgE2xnlQ7ROGR9D3ypGuaHv4XcNb"}),p={locationAvailable:!1,places:null,coords:{lat:null,lng:null},getPlaces:function(){return new Promise((function(e){}))}};var b=n(72),f=n(65),h=n(100),O=n(5),x={iter:0,pins:[],featureSet:{type:"FeatureCollection",features:[]},distribution:{},pinErr:null,getPins:function(){},createPin:function(){return new Promise((function(e){return e}))}};var v=n(67),m=function(e){return new Promise(function(){var t=Object(l.a)(u.a.mark((function t(n,r){var c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/usernames/".concat(e));case 3:return c=t.sent,t.t0=n,t.next=7,c.json();case 7:t.t1=t.sent,(0,t.t0)(t.t1),t.next=14;break;case 11:t.prev=11,t.t2=t.catch(0),r(t.t2);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e,n){return t.apply(this,arguments)}}())},g={ClientId:"2nl7v5gphbluvp0lhu8aooqhe3",UserPoolId:"us-east-1_Xsf7vUqcY"},w={isAuthenticated:!1,promptForCode:!1,headers:{get:{},post:{"Content-Type":""}},authError:null,getCode:function(e){},answer:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){})),logout:function(){return new Promise((function(e){return e()}))}};var k=n(3),S={freeze:function(){return function(){}},user:w,pins:x,location:p},y=Object(r.createContext)(S),C=function(){return Object(r.useContext)(y)};function P(e){var t=Object(r.useState)("none"),n=Object(o.a)(t,2),c=n[0],a=n[1],s=function(){return a("frozen"),function(){a("none")}},i=function(e){var t,n=new v.e(g),c=n.getCurrentUser(),a=Object(r.useState)(""),s=Object(o.a)(a,2),i=s[0],j=s[1],d=Object(r.useState)(null),p=Object(o.a)(d,2),b=p[0],f=p[1],h={get:{"x-amz-access-token":i},post:{"Content-Type":"application/json","x-amz-access-token":i}},O=Object(r.useState)(null),x=Object(o.a)(O,2),w=x[0],k=x[1],S=Object(r.useState)(!1),y=Object(o.a)(S,2),C=y[0],P=y[1],N=Object(r.useState)(!1),A=Object(o.a)(N,2),E=A[0],F=A[1],T=Object(r.useState)((function(e){})),z=Object(o.a)(T,2),I=z[0],L=z[1],U=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=4;break}c.getSession((function(e,t){return e?Promise.reject(e):(j(t.getAccessToken().getJwtToken()),f(new v.b({RefreshToken:t.getRefreshToken().getToken()})),P(!0),Promise.resolve())})),e.next=5;break;case 4:return e.abrupt("return",Promise.reject("user dne"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c&&b&&c.refreshSession(b,(function(e){return e?Promise.reject(e):U()}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(l.a)(u.a.mark((function e(r,a){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[new v.d({Name:"phone_number",Value:t})],n.signUp(t,"Passwords are useless!",s,[],(function(e,t){return e?a(e):((null===t||void 0===t?void 0:t.user)&&(c=t.user),r())}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var r=Object(l.a)(u.a.mark((function r(a){var s,o;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=e(),o=!0,r.prev=2,r.next=5,m(a);case 5:o=r.sent,r.next=11;break;case 8:r.prev=8,r.t0=r.catch(2),k("error while checking if user exists");case 11:if(o){r.next=21;break}return r.prev=12,r.next=15,J(a);case 15:r.next=21;break;case 17:return r.prev=17,r.t1=r.catch(12),k("error while registering user"),r.abrupt("return");case 21:t=new v.a({Username:a,ClientMetadata:{phoneNumber:a}}),(c=new v.c({Username:a,Pool:n})).setAuthenticationFlowType("CUSTOM_CHALLENGE"),c.initiateAuth(t,{onSuccess:function(){U(),s()},onFailure:function(e){k(e),s()},customChallenge:function(){var t=this;L((function(){return function(n){var r;null===(r=c)||void 0===r||r.sendCustomChallengeAnswer(n,t),s=e()}})),F(!0)}});case 25:case"end":return r.stop()}}),r,null,[[2,8],[12,17]])})));return function(e){return r.apply(this,arguments)}}(),X=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return e.next=4,R();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){X()}),[]),{isAuthenticated:C,promptForCode:E,headers:h,authError:w,getCode:G,answer:I,logout:function(){return new Promise(function(){var e=Object(l.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=4;break}return e.abrupt("return",t(c.signOut()));case 4:return e.abrupt("return",n("user dne"));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}(s),p=function(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(null),s=Object(o.a)(a,2),i=s[0],p=s[1],b=Object(r.useState)(null),f=Object(o.a)(b,2),h=f[0],O=f[1],x=Object(r.useState)(null),v=Object(o.a)(x,2),m=v[0],g=v[1],w=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.geocode({params:{category:"Arts and Entertainment,Coffee Shop,Nightlife Spot,Parks and Outdoors",location:"".concat(m,",").concat(h),distance:2e3,maxLocations:6},outFields:"*",authentication:d});case 3:r=e.sent,p(r.candidates),t(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),n();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(e){O(e.coords.latitude),g(e.coords.longitude),c(!0)},S=function(){c(!1),O(null),g(null)};return Object(r.useEffect)((function(){var e=window.navigator.geolocation.watchPosition(k,S,{enableHighAccuracy:!0,timeout:1e3});return function(){window.navigator.geolocation.clearWatch(e)}}),[]),{locationAvailable:n,places:i,coords:{lat:h,lng:m},getPlaces:w}}(),w=function(e,t,n){var c=Object(r.useState)(x.iter),a=Object(o.a)(c,2),s=a[0],i=a[1],j=Object(r.useState)(x.pins),d=Object(o.a)(j,2),p=d[0],v=d[1],m=Object(r.useState)(x.featureSet),g=Object(o.a)(m,2),w=g[0],k=g[1],S=Object(r.useState)({}),y=Object(o.a)(S,2),C=y[0],P=y[1],N=Object(r.useState)(x.pinErr),A=Object(o.a)(N,2),E=A[0],F=A[1],T=function(){var e=Object(l.a)(u.a.mark((function e(){var n,r,c,a,o,l,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/pins?lat=".concat(t.coords.lat,"&lng=").concat(t.coords.lng,"&r=0.1"));case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,c=r.reduce((function(e,t){return e+t.litness}),0),a=r.reduce((function(e,t){return e.includes(t.placeAddress)?e:[].concat(Object(h.a)(e),[t.placeAddress])}),[]),o=a.map((function(e){return r.filter((function(t){return t.placeAddress===e}))})).map((function(e){return e.reduce((function(e,t){return e+t.litness}),0)/c})),l=a.reduce((function(e,t,n){return Object(f.a)(Object(f.a)({},e),{},Object(b.a)({},t,o[n]))}),{}),P(l),j={type:"FeatureCollection",features:r.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:Object(O.d)([e.lng,e.lat])},properties:Object(f.a)({},e)}}))},v(r),k(j),i(s+1),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),F((null===e.t0||void 0===e.t0?void 0:e.t0.toString())||"unknown server error");case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t.coords.lng&&t.coords.lat&&T()}),[t.coords.lng,t.coords.lat]),{iter:s,pins:p,featureSet:w,distribution:C,pinErr:E,getPins:T,createPin:function(r,c,a){return new Promise(function(){var s=Object(l.a)(u.a.mark((function s(o,i){var l,j;return u.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:l=n();try{j=Object(f.a)(Object(f.a)({},t.coords),{},{litness:r,placeName:c,placeAddress:a}),fetch("https://1ge3owx5sf.execute-api.us-east-1.amazonaws.com/Prod/pins",{method:"post",headers:e.headers.post,body:JSON.stringify(j)})}catch(o){F((null===o||void 0===o?void 0:o.toString())||"unknown error")}finally{l()}case 2:case"end":return s.stop()}}),s)})));return function(e,t){return s.apply(this,arguments)}}())}}}(i,p,s),S={freeze:s,user:i,pins:w,location:p};return Object(k.jsxs)(y.Provider,{value:S,children:[Object(k.jsx)("div",{className:"freeze ".concat(c)}),e.children]})}function N(){var e,t=C().user,n=t.isAuthenticated,c=t.promptForCode,a=t.authError,s=t.getCode,i=t.answer,u=Object(r.useState)(""),l=Object(o.a)(u,2),j=l[0],d=l[1],p=Object(r.useRef)(null);return n?null:c?Object(k.jsxs)("div",{className:"auth-container",children:[Object(k.jsx)("header",{children:Object(k.jsx)("p",{children:"We texted you a code! Enter it here!"})}),Object(k.jsx)("input",{ref:p,autoComplete:"one-time-code",placeholder:"Secret code here"}),Object(k.jsx)("button",{onClick:function(){var e;(null===(e=p.current)||void 0===e?void 0:e.value)&&i(p.current.value)},children:"Send Code"})]}):Object(k.jsxs)("div",{className:"auth-conatiner",children:[Object(k.jsx)("header",{children:Object(k.jsx)("h1",{children:"Litness Sign In"})}),a&&Object(k.jsx)("div",{className:"error",children:a}),Object(k.jsx)("input",{type:"text",placeholder:"(012) 345-6789",autoComplete:"off",onChange:function(e){return d(e.target.value.replaceAll(/[^0-9]/g,""))},value:(e=j,e.length>10&&(e=e.substr(0,10)),0===e.length?e:e.length<4?"(".concat(e):e.length<7?"(".concat(e.substr(0,3),") ").concat(e.substr(3)):"(".concat(e.substr(0,3),") ").concat(e.substr(3,3),"-").concat(e.substr(6)))}),Object(k.jsx)("button",{onClick:function(){s(function(e){var t=e.replaceAll(/[^0-9]/g,"");if(10!==t.length)throw new Error("Phone number must be 10 digits, current length: "+t.length);return"+1"+t}(j))},children:"Sign In"})]})}var A=n.p+"static/media/pin.c45e97d1.png",E=n.p+"static/media/fire.4fa412f3.png";function F(){var e=C(),t=Object(r.useState)(!1),n=Object(o.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(!1),i=Object(o.a)(s,2),j=i[0],d=i[1],p=Object(r.useState)(0),b=Object(o.a)(p,2),f=b[0],h=b[1],O=function(){var t=Object(l.a)(u.a.mark((function t(n,r){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a(!1),d(!1),h(0),t.next=6,e.pins.createPin(f,n,r);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),alert((null===t.t0||void 0===t.t0?void 0:t.t0.toString())||"error while creating pin");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n){return t.apply(this,arguments)}}(),x=function(t){return Object(l.a)(u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,d(!0),a(!1),h(t),n.next=6,e.location.getPlaces();case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),alert("error while getting nearby places");case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))};return e.user.isAuthenticated&&e.location.locationAvailable?e.location.places&&f>0?Object(k.jsx)("div",{className:"drop-pin-backdrop",children:Object(k.jsxs)("div",{className:"drop-pin place-list",children:[Object(k.jsx)("header",{children:Object(k.jsx)("h1",{children:"Select current location:"})}),e.location.places.map((function(e){return Object(k.jsx)("div",{onClick:function(){return O(e.attributes.PlaceName,e.attributes.Place_addr)},className:"drop-pin place",children:Object(k.jsx)("h3",{children:e.attributes.PlaceName})})}))]})}):j?Object(k.jsx)("div",{className:"drop-pin-backdrop",children:Object(k.jsxs)("div",{className:"drop-pin place-list",children:[Object(k.jsx)("div",{className:"drop-pin place placeholder",children:Object(k.jsx)("header",{children:Object(k.jsx)("h2",{})})}),Object(k.jsx)("div",{className:"drop-pin place placeholder",children:Object(k.jsx)("header",{children:Object(k.jsx)("h2",{})})}),Object(k.jsx)("div",{className:"drop-pin place placeholder",children:Object(k.jsx)("header",{children:Object(k.jsx)("h2",{})})}),Object(k.jsx)("div",{className:"drop-pin place placeholder",children:Object(k.jsx)("header",{children:Object(k.jsx)("h2",{})})}),Object(k.jsx)("div",{className:"drop-pin place placeholder",children:Object(k.jsx)("header",{children:Object(k.jsx)("h2",{})})})]})}):c?Object(k.jsx)("div",{className:"drop-pin-backdrop",children:Object(k.jsxs)("div",{className:"drop-pin-list",children:[Object(k.jsx)("button",{onClick:function(){return a(!1)},className:"fire-button cancel",children:"X"}),Object(k.jsx)("button",{onClick:x(1),className:"fire-button one",children:Object(k.jsx)("img",{src:E})}),Object(k.jsxs)("button",{onClick:x(2),className:"fire-button two",children:[Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E})]}),Object(k.jsxs)("button",{onClick:x(3),className:"fire-button three",children:[Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E})]}),Object(k.jsxs)("button",{onClick:x(4),className:"fire-button four",children:[Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E})]}),Object(k.jsxs)("button",{onClick:x(5),className:"fire-button five",children:[Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E}),Object(k.jsx)("img",{src:E})]})]})}):Object(k.jsx)("button",{onClick:function(){return a(!0)},className:"drop-pin-button",children:Object(k.jsx)("img",{src:A})}):null}function T(){var e=C();return Object(k.jsx)("div",{style:{display:"none"},children:Object(k.jsxs)("ul",{children:[Object(k.jsxs)("li",{children:["[",e.location.coords.lng,", ",e.location.coords.lat,"]"]}),e.pins.pins.map((function(e){return Object(k.jsx)("li",{children:JSON.stringify(e)})}))]})})}var z=n(98),I=n(54),L=n(101),U=n(90),R=n(92),J=n(91),G=n(99),X=n(93),H=n(86),M=n(70),V=function(e){return new X.b({image:new M.a({radius:2*parseInt(e.get("litness")),fill:new H.a({color:[255,0,0,parseInt(e.get("litness"))/25]})})})};function Z(){var e=C(),t=Object(r.useRef)(null),n=Object(r.useState)(null),c=Object(o.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(16),u=Object(o.a)(i,2),l=u[0],j=(u[1],Object(r.useState)(null)),d=Object(o.a)(j,2),p=d[0],b=d[1];return Object(r.useEffect)((function(){var t={view:new I.a({zoom:l,minZoom:l,maxZoom:l}),layers:[new L.a({source:new G.a}),new U.a({source:new R.a({features:(new J.a).readFeatures(e.pins.featureSet)})})],controls:[],overlays:[]},n=new z.a(t);s(n)}),[]),Object(r.useEffect)((function(){a&&t.current&&a.setTarget(t.current)}),[e.location.locationAvailable]),Object(r.useEffect)((function(){a&&a.getView().setZoom(l)}),[l]),Object(r.useEffect)((function(){p&&a&&a.getView().setCenter(p)}),[p]),Object(r.useEffect)((function(){e.location.coords.lat&&e.location.coords.lng&&b(Object(O.d)([e.location.coords.lng,e.location.coords.lat]))}),[e.location.coords.lat,e.location.coords.lng]),Object(r.useEffect)((function(){null===a||void 0===a||a.getLayers().removeAt(1);var t={source:new R.a({features:(new J.a).readFeatures(e.pins.featureSet)}),style:V},n=new U.a(t);console.log(e.pins.featureSet,n,t),null===a||void 0===a||a.getLayers().push(n)}),[e.pins.iter]),Object(k.jsx)("div",{id:"ol-map",className:e.user.isAuthenticated?void 0:"hidden",ref:t})}var _=function(){return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(N,{}),Object(k.jsx)(F,{}),Object(k.jsx)(Z,{}),Object(k.jsx)(T,{})]})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,131)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};s.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(P,{children:Object(k.jsx)(_,{})})}),document.getElementById("root")),D()}},[[130,1,2]]]);
//# sourceMappingURL=main.2d4c67b7.chunk.js.map